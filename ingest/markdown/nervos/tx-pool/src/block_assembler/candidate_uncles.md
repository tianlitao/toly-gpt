[View code on GitHub](https://github.com/nervosnetwork/ckb/blob/develop/tx-pool/src/block_assembler/candidate_uncles.rs)

The `CandidateUncles` struct is a container for storing uncle blocks that are candidates for inclusion in the blockchain. Uncle blocks are blocks that are not included in the main chain but are still valid and can be included in the blockchain as a reward for miners. The purpose of this container is to keep track of uncle blocks that have been received but not yet included in the blockchain.

The container is implemented as a `BTreeMap` where the keys are block numbers and the values are sets of uncle blocks. The container has a maximum size of `MAX_CANDIDATE_UNCLES` and a maximum number of uncles per height of `MAX_PER_HEIGHT`. When a new uncle block is inserted into the container using the `insert` method, the container checks if it has reached its maximum size. If it has, it removes the oldest uncle block that has the lowest block number. If the new uncle block has a block number that is lower than the oldest uncle block, it is not inserted into the container. If the new uncle block is inserted, the count of uncle blocks in the container is incremented.

The container provides methods for getting the length of the container (`len`), checking if the container is empty (`is_empty`), getting an iterator over the values of the container (`values`), and removing uncle blocks from the container by their number (`remove_by_number`). The container also provides a method for preparing uncle blocks for inclusion in the blockchain (`prepare_uncles`). This method takes a snapshot of the current state of the blockchain and the current epoch and returns a vector of uncle blocks that are candidates for inclusion in the blockchain. The method checks if the uncle block is in the same epoch as the current epoch, has the same difficulty as the current epoch, and has a block number less than the candidate number (the tip number of the snapshot plus one). If the uncle block meets these conditions and is not already in the main chain or in the list of uncles, it is added to the vector of uncle blocks.

Overall, the `CandidateUncles` container is an important component of the blockchain that helps to keep track of uncle blocks that are candidates for inclusion in the blockchain. It provides methods for inserting, removing, and preparing uncle blocks for inclusion in the blockchain.
## Questions:
 1. What is the purpose of the `CandidateUncles` struct and its methods?
- The `CandidateUncles` struct is a container for storing uncle blocks that are candidates for inclusion in the blockchain. Its methods allow for inserting, removing, and retrieving uncle blocks from the container, as well as preparing a list of uncle blocks to be included in the blockchain based on certain criteria.

2. What is the significance of the constants `MAX_CANDIDATE_UNCLES` and `MAX_PER_HEIGHT`?
- `MAX_CANDIDATE_UNCLES` is the maximum number of candidate uncle blocks that can be stored in the container at any given time. `MAX_PER_HEIGHT` is the maximum number of uncle blocks that can be stored in the container for a given block height. These constants are used to limit the size of the container and prevent it from growing too large.

3. What is the purpose of the `prepare_uncles` method and how does it determine which uncle blocks to include in the blockchain?
- The `prepare_uncles` method retrieves uncle blocks from the container that meet certain criteria for inclusion in the blockchain. These criteria include being in the same epoch and sharing the same difficulty as the current epoch, having a block number less than the candidate number (the tip number of the snapshot plus one), and having a parent block that is either an ancestor of the current block or embedded in the current block or its ancestors as an uncle. If there are more uncle blocks that meet these criteria than the maximum number allowed by the consensus rules, the method selects the uncle blocks with the highest priority based on their position in the container.
